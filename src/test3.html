<html>
  <meta charset="utf-8">
  <script src="./d3.min.js"></script>
  <script>
    var svg   = null;

    function setup() {
      var width = 960,
          height = 500;

      svg = d3.select("body")
          .append("svg")
          .attr("width", width)
          .attr("height", height)
          .append("g")
          .attr("transform", "translate (" + 32 + "," + height/2 + ")");
    }

    function update(data, time) {

      // DATA JOIN
      // Join new data with old elements, if any.
      var text = svg.selectAll("text")
          .data(data, function(d) { return d; });

      // UPDATE
      // Update old elements as needed.
      text.attr("class", "update");

      // ENTER
      // Create new elements as needed.
      var enterSelection = text.enter();

      enterSelection
          .append("text")
          .attr("class", "enter");

      // ENTER + UPDATE
      // Appending to the enter selection expands the update selection to include
      // entering elements; so, operations on the update selection after appending to
      // the enter selection will apply to both entering and updating nodes.
      text
        .transition().duration(time)
        .attr("x", function(d, i) { return i * 64; })
        .text(function(d) { return d; });

      // EXIT
      // Remove old elements as needed.
      text.exit().remove();
    }

    // Grab a random sample of letters from the alphabet, in alphabetical order.
    // setInterval(function() {
    //   update(d3.shuffle(alphabet)
    //       .slice(0, Math.floor(Math.random() * 26))
    //       .sort());
    // }, 1500);

  </script>
  <style>

  text {
    font: bold 32px monospace;
  }

  .enter text {
    color: green;
  }

  .update text {
    color: #993;
  }

  </style>
  <body>
    <button onclick="sort()">hello</button>

    <script type="text/javascript">

    function swap(x, y, vector) {
      var tmp = vector[x];
      vector[x] = vector[y];
      vector[y] = tmp;
    }

    // create steps
    function createSteps(vector) {
      var stepsBuffer = [];
      for (j = 0; j < vector.length; j++) {
        for (k = 0; k < vector.length - 1; k++) {
          if (vector[k] > vector[k+1]) {
            swap(k,k+1,vector);
            stepsBuffer.push([k,k+1]);
          }
        }
      }
      return stepsBuffer;
    }

    var i = 0;
    var steps = null;
    var data = null;

    function sort() {
      if ( i >= steps.length ) return;

      swap(steps[i][0], steps[i][1], data);
      update(data, 1500);

      i++;
    }

    // initial setup
    setup();
    data = [4,2,5,3,1];
    update(data, 0);
    steps = createSteps(data.slice());

    </script>
  </body>
</html>