<html>
  <meta charset="utf-8">
  <script src="./d3.min.js"></script>
  <script>
    var svg   = null;

    function setup() {
      var width = 960,
          height = 500;

      svg = d3.select("body")
          .append("svg")
          .attr("width", width)
          .attr("height", height)
          .append("g")
          .attr("transform", "translate (" + 32 + "," + height/2 + ")");
    }

    function update(data, time) {

      // DATA JOIN
      // Join new data with old elements, if any.
      var text = svg.selectAll("text")
          .data(data, function(d) { return d; });

      // UPDATE
      // Update old elements as needed.
      text
        .attr("class", "update");

      // ENTER
      // Create new elements as needed.
      text.enter()
          .append("text")
          .attr("class", "enter");

      // ENTER + UPDATE
      // Appending to the enter selection expands the update selection to include
      // entering elements; so, operations on the update selection after appending to
      // the enter selection will apply to both entering and updating nodes.
      text
        .transition().duration(time)
        .attr("x", function(d, i) { return i * 64; })
        .text(function(d) { return d; });

      // EXIT
      // Remove old elements as needed.
      text.exit().remove();
    }

  </script>
  <style>

  text {
    font: bold 32px monospace;
  }

  .enter text {
    color: green;
  }

  .update text {
    color: #993;
  }

  </style>
  <body>
    <button onclick="sort()">hello</button>

    <script type="text/javascript">

    function swap(x, y, data) {
      var tmp = data[x];
      data[x] = data[y];
      data[y] = tmp;
      return [x,y];
    }

    function createSteps(vector) {
      var stepsBuffer = [];
      var partition = 0;
      for (j = 0; j < vector.length; j++) {
        
        var x = vector[j];
        var k = j - 1;
        while (k >= 0 && x < vector[k]) {
          k--;
        }

        for (n = j; n > k + 1; n--) {
          stepsBuffer.push(swap(n,n-1,vector));
        }
      }
      return stepsBuffer;
    }

    var steps = [];
    var data = null;
    var i = 0;

    function sort() {
      if ( i >= steps.length ) return;
      
      swap(steps[i][0], steps[i][1], data);
      update(data, 500);

      i++;
    }

    // initial setup
    setup();
    data = [134,35,67,2,77,11,90,7];
    steps = createSteps(data.slice());
    update(data, 0);

    </script>
  </body>
</html>